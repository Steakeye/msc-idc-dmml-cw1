---
title: "Forecasting1"
output: html_document
---


```{r setup-f1, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r deps-f1, echo=FALSE, include=FALSE, message=FALSE}
mirrorUrl = "http://cran.ma.imperial.ac.uk"

# Install and load all packages up-front!
if(!require(readxl)) install.packages("readxl", repos = mirrorUrl)
if(!require(neuralnet)) install.packages("neuralnet", repos = mirrorUrl)
#
library("readxl")
library("neuralnet")

set.seed(1234)
```

<section>

#Question 3: Forecasting (MLP)

##Premise

>You need to construct an MLP neural network for this problem. You need to consider the appropriate input vector, as well as the internal network structure (hidden layers, nodes, learning rate). You may consider any de-trending scheme if you feel is necessary. Write a code in R Studio to address all these requirements. You need to show the performance of your network both graphically as well as in terms of usual statistical indices (MSE, RMSE and MAPE). Hint: Experiment with various network structures and show a comparison table of their performances. This will be a good justification for your final network choice. Show all your working steps. As everyone will have different forecasting result, emphasis in the marking scheme will be given to the adopted methodology and the explanation/justification of various decisions you have taken in order to provide an acceptable, in terms of performance, solution. The input selection problem is very important. Experiment with various options (i.e. how many past values you need to consider as potential network inputs).

<!--
3rd Objective (MLP)
• Discuss the input selection problem and propose various input configurations 10
• Design a number of MLPs, using various structures (layers/nodes) / input parameters and show in a table their performances comparison based on provided stat. indices 15
• Provide your best results both graphically (your prediction output vs. desired output) and via performance indices 5

resources:
-->

##Preparation of data

The exchange data needs to be loaded, paritioned, and scaled.

```{r prep-data-f1}
#going to import the Excel spreadsheet WhiteWine dataset
exchange.raw <- read_excel("../data/Exchange.xlsx")
```

Here's a glance at the dataset

```{r show-exchange-f1}
head(exchange.raw)
str(exchange.raw)
```

We want to scale the data to allow  for faster training. 

```{r scale-exchange-f1}
exchange.scaled <- exchange.raw

exchange.scaled[3] <- scale(exchange.scaled[3])

#Summary of scaled wine data
summary(exchange.scaled)
```

And partition the data into a set for training and another for testing the neural network after.

```{r subset-exchange-f1}
exchange.scaled_train <- head(exchange.scaled, 320)
exchange.scaled_test <- tail(exchange.scaled, -320) #exchange.scaled[-1:-320, 1:3] #also works!


#Summary of scaled data
summary(exchange.scaled_train)
summary(exchange.scaled_test)
```

###Setting up the training data

Because we're looking to train the neural network on time-series data, we have to transform the data to make it easy to pass in time based input, which means we need to provide more than 1 input value at a time to train against the desired output; to that end, below is a code chunk that takes the exchange rate values and creates rows where the last entry is the desired output, the third is considered day 0 and the 1st to entries are 2 previous days from day 0.

```{r matrix-exchange-f1}

row_count <- nrow(exchange.scaled_train)

staggered_data_matrix <- matrix(exchange.scaled_train$`USD/EUR`, row_count, 4)

train_data_length <- length(staggered_data_matrix)
for (i in 1:row_count){
  staggered_data_matrix[i,] <-c(staggered_data_matrix[i], staggered_data_matrix[i+1], staggered_data_matrix[i+2], staggered_data_matrix[i+3])
}

staggered_data_matrix <- as.data.frame(head(staggered_data_matrix, row_count - 3))

colnames(staggered_data_matrix) <- c("Input_dneg2", "Input_dneg1", "Input_d0", "Output")

#Summary of training data
head(staggered_data_matrix)
```

##Creating & using the neural net

###Training the netwotk

Now we have the data in a format such that we can provide 3 consecutive days as input and the following day as desired output, we are ready to train the neural network.

```{r train-mlp-f1}
#derivatives of the error function as stopping criteria.
#net.sqrt &lt;- neuralnet(Output~Input,trainingdata, hidden=10, threshold=0.01)
#print(net.sqrt)
mlp.form1 <- as.formula("Output ~ Input_d0 + Input_dneg1 + Input_dneg2")

mlp.nn1 <- neuralnet(mlp.form1, staggered_data_matrix, hidden = c(8,4,2), threshold=0.01)
```

Now the neural network has been trained we can obsever a representation of its structure.

```{r display-mlp-f1}
plot(mlp.nn1)
```

###Training the netwotk

## Conclusion

...


</section>
