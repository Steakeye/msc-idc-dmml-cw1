---
title: "WhiteWine"
output: html_document
---


```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, echo=FALSE, include=FALSE, message=FALSE}
mirrorUrl = "http://cran.ma.imperial.ac.uk"

# Install and load all packages up-front!
if(!require(readxl)) install.packages("readxl", repos = mirrorUrl)
if(!require(corrplot)) install.packages("corrplot", repos = mirrorUrl)
#
library("readxl")
library("dendextend")
library("corrplot")

set.seed(1234)
```

<section>

#Question 2: White Wine clustering (Hierarchical)

##Premise

>You need to conduct the hierarchical clustering (agglomerative) clustering analysis of the white wine sheet. Investigate the hclust() function for single, complete, average methods. Create the visualization of all methods using a dendrogram. Look at the cophenetic correlation between each clustering result using cor.dendlist. Discuss the produced results after using the coorplot function. Write a code in R Studio to address all the above
issues.

<!--
2nd Objective (hierarchical clustering)
• Perform hierarchical clustering (for single, complete, etc) 15
• Create a dendrogram 5
• Check the cophenetic correlation and discuss your findings 3
• Coorplot function and discuss your findings 2

resources:
https://drive.google.com/file/d/0B-1zDxRmAKmjeTFzM182Szd3WDQ/view
https://drive.google.com/drive/folders/0B-1zDxRmAKmjdFYxcEVFaFZZcE0
-->

##Preparation of data

As with Question 1, the data needs to be loaded, paritioned, then scaled. Assuming that this has all been done as before - there's no need to demonstrate the exact same execution of code - we can simply demonstrate we have our data ready to work with.

```{r, echo=FALSE, include=FALSE, message=FALSE}
#going to import the Excel spreadsheet WhiteWine dataset
wine.raw <- read_excel("../data/Whitewine.xlsx")

#Sample the wine..?
samp <- sample(nrow(wine.scaled), 0.6 * nrow(wine.scaled))
wine.sampled <- wine.scaled[samp, ]

#Separating wine data from quality column
wine.all_but_q <- wine.sampled[1:11]
wine.q <- wine.raw$quality

#Wine properties
str(wine.all_but_q)

#Wine quality values
str(wine.q)

#Now we scale the data
wine.scaled <- as.data.frame(scale(wine.all_but_q))
```

So here's just the summary of the scaled data
```{r}
summary(wine.scaled)
```

###Hierarchical clustering

Hierarchical clustering methods use a distance matrix as input for the algorithms; to that end, we need to transofrm the scaled date into a distance matrix before we pass it into our hierarchical clusting function.

```{r}
wine.dist_matrix_euclidean <- dist(wine.scaled) # Euclidean distance matrix.
summary(wine.dist_matrix_euclidean)
```

Now we can start clustering data using the hclust library. As per the requirements of this question we are calling hclust 3 times, to evaluate the "single", "complete" and "average" methods for heirarchical clustering. Assuming this hierarchcal clustering is meant to try and find relationships between the quantitative Wine properties and Wine quality, and knowing from the previous question that there are only 7 unique values for quality across the entire dataset, the next step is to cut out cluster trees to only have 7 branches.

```{r}
wine.hclust_single <- hclust(wine.dist_matrix_euclidean, method = "single")
wine.hclust_complete <- hclust(wine.dist_matrix_euclidean, method = "complete")
wine.hclust_average <- hclust(wine.dist_matrix_euclidean, method = "average")

#Display dendrograms
plot(wine.hclust_single, main="Hierarchical clustering White Wine", sub = "Single method", labels=FALSE)
rect.hclust(wine.hclust_single, k=7, border="green") 
plot(wine.hclust_complete, main="Hierarchical clustering White Wine", sub = "Complete method", labels=FALSE)
rect.hclust(wine.hclust_complete, k=7, border="green") 
plot(wine.hclust_average, main="Hierarchical clustering White Wine", sub = "Average method", labels=FALSE)
rect.hclust(wine.hclust_average, k=7, border="green") 

wine.hclust_single_g7 <- cutree(wine.hclust_single, k=7)
table(wine.hclust_single_g7)

wine.hclust_complete_g7 <- cutree(wine.hclust_complete, k=7)
table(wine.hclust_complete_g7)

wine.hclust_average_g7 <- cutree(wine.hclust_average, k=7)
table(wine.hclust_average_g7)
```

###Interpreting the data

My observation from the cut trees is that unless the data is especially skewed, it seems like using the Complete method is the one method of the three tried that might have any hope of clustering in a way that could correlate, albeit weakly, with Quality. Having said that


```{r}
d_list <- dendlist(
  wine.hclust_single %>% as.dendrogram,
  wine.hclust_complete %>% as.dendrogram,
  wine.hclust_average %>% as.dendrogram
)

cophentic_coefficient <- cor.dendlist(d_list, "cophenetic")

corrplot(cophentic_coefficient, "pie", "lower")

```

## Conclusion

...

</section>
